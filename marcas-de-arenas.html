<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Marcas de arenas</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="./css/grid.css" />
    <link rel="stylesheet" href="./css/spacing-utilities.css" />
    <link rel="stylesheet" href="./css/global.css" />
    <link rel="stylesheet" href="./css/navbar.css" />
    <link rel="stylesheet" href="./css/carrusel.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wdth,wght@0,75..100,300..800;1,75..100,300..800&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Reset */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      :root {
        --green-light: #e8f5d0;
        --green-dark: #374d10;
        --grad-from: #c0d92c;
        --grad-to: #a6c200;
      }

      /* --- Logos row --- */
      .brand-row {
        display: flex;
        justify-content: space-evenly;
        margin-top: 3rem;
        margin: 4rem;
      }
      .brand-row img {
        width: 90px;
        height: auto;
        cursor: pointer;
        opacity: 0.6;
        transition: opacity 0.3s;
      }
      .brand-row img.active,
      .brand-row img:hover {
        opacity: 1;
      }

      /* --- Products grid --- */
      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 2rem;
        max-width: 1000px;
        margin: 0 auto 2rem;
        padding: 0 1rem;
        justify-items: center;
      }
      .product-block {
        display: flex;
        align-items: center;
        cursor: pointer;
        flex-direction: column;
      }

      .product-block img {
        position: relative;
        width: 100%;
        max-width: 300px;
        height: auto;
        border-radius: 8px;
        object-fit: cover;
        z-index: 2;
      }
      .product-block .category-btn {
        margin-top: 1rem;
        background: var(--green-dark);
        color: #fff;
        border: none;
        padding: 0.4rem 1rem;
        border-radius: 20px;
        cursor: pointer;
        z-index: 3;
      }

      /* Responsive tweaks */
      @media (max-width: 769px) {
        .brand-row img {
          width: 60px;
        }
        .brand-row {
          margin-top: 2rem;
        }
        .products-grid {
          grid-template-columns: repeat(2, 1fr);
        }
        .products-grid.single {
          grid-template-columns: 1fr;
        }
        .product-block img {
          max-width: 250px;
        }
      }
    </style>
  </head>
  <body>
    <div class="fondo">
      <div
        id="navbar-placeholder"
        style="
          position: sticky !important;
          top: 0;
          z-index: 999;
          overflow: hidden;
        "
      ></div>
      <div class="fondo-marcas">
        <!-- title -->
        <!--          <div class="col-sm-12 col-md-12">
            <h1 class="mb-0 text-center">Nuestras marcas</h1>
          </div>
          <div class="col-sm-12 col-md-12">
            <h2 class="mt-0 text-center">de arena para gato</h2>
          </div>
        </div> -->
        <div class="col-sm-12 col-md-12 hero-content cate mt-3 pb-0">
          <h1 class="my-0">
            Nuestras marcas<br />
            <h2 class="my-0">de arenas para gatos</h2>
          </h1>
        </div>
        <!-- 1) Fila de marcas -->
        <!-- Logos de marcas -->
        <div id="brand-row" class="brand-row"></div>

        <!-- Galería de productos -->
        <div id="products-container" class="products-grid"></div>
        <!--  -->
        <!-- img marcas -->

        <!--    <div
          class="row d-center col-sm-12 col-md-12 row text-center"
          style="align-content: center; z-index: 2"
        >
          <div class="wrapper col-md-8 col-sm-10">
            <div class="scroll-container">
              <div class="buttons-marcas"></div>
            </div>
          </div>
        </div> -->

        <!--  -->
      </div>
      <!-- products -->
      <!--  <div class="products-conteiner row col-sm-12 col-md-12">
        <div class="product-in-filter col-md-3 text-center">
          <img src="./assets/img/pipicat-product.svg" alt="" width="100%" />
 
        </div>
        <div class="product-in-filter col-md-3 text-center">
          <img
            src="./assets/img/pipicat-super-product.svg"
            alt=""
            weight="100%"
          />
      
          <button class="button-link col-md-5">Ver más</button>
        </div>
      </div> -->
      <div id="topbar-placeholder"></div>
    </div>
    <!--    <script src="./assets/logos-img.js"></script> -->
    <script type="module">
      import { addComponent, addNavFunc } from "./javascript/addComponents.js";

      // Espera a que el DOM esté completamente cargado antes de ejecutar el script
      document.addEventListener("DOMContentLoaded", async () => {
        await addComponent("navbar-placeholder", "components/navbar.html");
        addNavFunc();
        addComponent("topbar-placeholder", "components/footer.html");
      });
      const BRAND_PATH =
        "https://stalwart-faloodeh-22bebe.netlify.app/public/assets/svg/marcas/logos";
      const MOBILE_PATH =
        "https://stalwart-faloodeh-22bebe.netlify.app/public/assets/svg/marcas/mobile";
      const WEB_PATH =
        "https://stalwart-faloodeh-22bebe.netlify.app/public/assets/svg/marcas/web";
      const BRANDS = ["london", "gatuna", "pipicat", "hey"];
      const CATEGORIES = ["basica", "premium", "super", "black"];

      const MOBILE_BREAK = 767;

      // Utility: test imagen sin CORS
      function imageExists(url) {
        return new Promise((res) => {
          const i = new Image();
          i.src = url;
          i.onload = () => res(true);
          i.onerror = () => res(false);
        });
      }

      // Saber móvil vs. web
      function isMobile() {
        return window.innerWidth <= MOBILE_BREAK;
      }

      // Leer brand de URL
      function getBrand() {
        const p = new URLSearchParams(location.search);
        return p.get("brand") || "london";
      }

      // Render row de logos
      async function renderBrands(active) {
        const row = document.getElementById("brand-row");
        row.innerHTML = "";
        for (const b of BRANDS) {
          const url = `${BRAND_PATH}/${b}.png`;
          if (await imageExists(url)) {
            const img = document.createElement("img");
            img.src = url;
            img.alt = b;
            if (b === active) img.classList.add("active");
            img.addEventListener("click", () => {
              history.pushState({ brand: b }, "", `?brand=${b}`);
              init();
            });
            row.appendChild(img);
          }
        }
      }

      // Render productos para la marca (todas las categorías que existan)
      async function renderProducts(brand) {
        const cont = document.getElementById("products-container");
        cont.innerHTML = "";
        const base = (isMobile() ? MOBILE_PATH : WEB_PATH) + "/" + brand;
        for (const cat of CATEGORIES) {
          const imgUrl = `${base}/${cat}.svg`;
          if (await imageExists(imgUrl)) {
            const block = document.createElement("div");
            block.className = "product-block";

            const img = document.createElement("img");
            img.src = imgUrl;
            img.alt = `${brand} ${cat}`;

            const btn = document.createElement("a");
            btn.className = "btn-vermas";
            btn.textContent = cat[0].toUpperCase() + cat.slice(1);
            btn.addEventListener("click", () => {
              window.location.href = `/item-marca.html?brand=${brand}&category=${cat}`;
            });
            block.addEventListener("click", () => {
              window.location.href = `/item-marca.html?brand=${brand}&category=${cat}`;
            });

            block.append(img, btn);
            cont.appendChild(block);
          }
        }
        // Si sólo hay un bloque, agregar clase 'single'
        if (cont.children.length === 1) {
          cont.classList.add("single");
        } else {
          cont.classList.remove("single");
        }
      }

      // Inicializa todo
      async function init() {
        const brand = getBrand();
        await renderBrands(brand);
        await renderProducts(brand);
      }

      // React to history nav & resize
      window.addEventListener("popstate", init);
      window.addEventListener("DOMContentLoaded", init);
      window.addEventListener("resize", () => {
        clearTimeout(window._r);
        window._r = setTimeout(init, 200);
      });
    </script>
  </body>
</html>
